<!DOCTYPE html><html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>貓咪抽卡機</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.png" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: sans-serif;
      background: #fff8f0;
      margin: 0;
      padding: 1rem;
      text-align: center;
    }
    button {
      padding: 1rem;
      font-size: 1rem;
      margin: 0.5rem;
      border-radius: 0.5rem;
    }
    #card {
      width: 150px;
      height: 200px;
      margin: 2rem auto;
      perspective: 1000px;
    }
    .flip {
      width: 100%;
      height: 100%;
      position: relative;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }
    .flipped {
      transform: rotateY(180deg);
    }
    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 1rem;
      background-size: cover;
    }
    .card-back {
      background-image: url("Ggggg.png");
      background-color: #ccc;
    }
    .card-front::before {
      content: attr(data-rarity);
      position: absolute;
      top: 0.3rem;
      left: 0.5rem;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      padding: 0.2rem 0.5rem;
      border-radius: 0.5rem;
      font-size: 0.8rem;
    }
    .card-front {
      transform: rotateY(180deg);
    }
  </style>
</head>
<body>
  <h1>貓咪抽卡機</h1>
  <div id="auth">
    <input id="nickname" placeholder="輸入暱稱登入" />
    <button onclick="login()">登入</button>
  </div>
  <div id="game" style="display:none">
    <p>你好，<span id="user"></span>！VIP 等級：<span id="vip"></span></p>
    <p>今日剩餘抽卡次數：<span id="draws"></span></p>
    <button onclick="draw()">抽卡</button>
    <button onclick="showBag()">查看包包</button>
    <button onclick="logout()">登出</button>
    <div id="card">
      <div class="flip" id="flip">
        <div class="card-face card-back"></div>
        <div class="card-face card-front" id="front"></div>
      </div>
    </div>
  </div>  <script>
    let userData = {};

    const rarities = [
      { name: "SC", prob: 1 },
      { name: "SGR", prob: 3 },
      { name: "LSR", prob: 6 },
      { name: "UR", prob: 15 },
      { name: "R", prob: 75 },
    ];

    function getUserData(nick) {
      const raw = localStorage.getItem("catgacha-" + nick);
      return raw ? JSON.parse(raw) : { vip: 0, cards: {}, draws: 5 };
    }

    function saveUserData(nick, data) {
      localStorage.setItem("catgacha-" + nick, JSON.stringify(data));
    }

    function login() {
      const nick = document.getElementById("nickname").value;
      if (!nick) return;
      userData.name = nick;
      userData.data = getUserData(nick);
      document.getElementById("auth").style.display = "none";
      document.getElementById("game").style.display = "block";
      updateUI();
    }

    function logout() {
      saveUserData(userData.name, userData.data);
      userData = {};
      document.getElementById("auth").style.display = "block";
      document.getElementById("game").style.display = "none";
    }

    function updateUI() {
      document.getElementById("user").textContent = userData.name;
      document.getElementById("vip").textContent = userData.data.vip;
      document.getElementById("draws").textContent = userData.data.draws;
    }

    function draw() {
      if (userData.data.draws <= 0) return alert("今天已抽完");

      const rand = Math.random() * 100;
      let total = 0, rarity = "R";
      for (const r of rarities) {
        total += r.prob;
        if (rand <= total) {
          rarity = r.name;
          break;
        }
      }

      const flip = document.getElementById("flip");
      const front = document.getElementById("front");
      front.setAttribute("data-rarity", rarity);
      front.style.backgroundImage = `url(card-${rarity}.png)`;

      flip.classList.remove("flipped");
      setTimeout(() => {
        flip.classList.add("flipped");
      }, 100);

      userData.data.cards[rarity] = (userData.data.cards[rarity] || 0) + 1;
      userData.data.draws--;
      updateVip(userData.data);
      updateUI();
      saveUserData(userData.name, userData.data);
    }

    function updateVip(data) {
      let r = 30, ur = 15, lsr = 5, sgr = 3, sc = 1;
      for (let i = 1; i <= data.vip; i++) {
        r += Math.ceil(r * 0.5);
        ur += Math.ceil(ur * 0.5);
        lsr += Math.ceil(lsr * 0.5);
        sgr += Math.ceil(sgr * 0.5);
        sc += Math.ceil(sc * 0.5);
      }
      const c = data.cards;
      if ((c.R || 0) >= r) { c.R -= r; data.vip++; return; }
      if ((c.UR || 0) >= ur) { c.UR -= ur; data.vip++; return; }
      if ((c.LSR || 0) >= lsr) { c.LSR -= lsr; data.vip++; return; }
      if ((c.SGR || 0) >= sgr) { c.SGR -= sgr; data.vip++; return; }
      if ((c.SC || 0) >= sc) { c.SC -= sc; data.vip++; return; }
    }

    function showBag() {
      const cards = userData.data.cards;
      let list = "你擁有的卡片：\n";
      for (let r of ["R", "UR", "LSR", "SGR", "SC"]) {
        list += `${r}：${cards[r] || 0} 張\n`;
      }
      alert(list);
    }

    window.addEventListener("load", () => {
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service-worker.js");
      }
    });
  </script></body>
</html>
